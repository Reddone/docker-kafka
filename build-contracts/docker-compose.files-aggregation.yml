version: '2.0'

services:

  zookeeper:
    build: ../kafka
    entrypoint: ./bin/zookeeper-server-start.sh
    command:
      - config/zookeeper.properties

  kafka-0:
    build: ../kafka
    links:
      - zookeeper
    entrypoint: ./bin/kafka-server-start.sh
    command:
      - config/server.properties
      - --override
      -   zookeeper.connect=zookeeper:2181
      - --override
      -   broker.id=0
      - --override
      -   advertised.listener=PLAINTEXT://kafka-0:9092

  connect-files:
    build: ../connect-files
    links:
      - kafka-0

  test-connect-files-real-logs:
    build: ../connect-files
    links:
      - kafka-0
    volumes:
      - /var/log:/logs

  test-consume-files:
    image: solsson/kafkacat@sha256:7a5961f861ddad53c25227511b9f36a5c13bc43296470b383be2f3e8e3a506f4
    command:
      - -b
      - kafka-0:9092
      - -t
      - files-000
      - -C
      - -o
      - beginning
